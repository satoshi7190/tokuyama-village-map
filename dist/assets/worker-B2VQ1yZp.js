(function(){"use strict";var J=`#version 300 es
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform vec4 u_color;
uniform sampler2D u_image1;
uniform sampler2D u_image2;
uniform int u_isPolygon;

in vec2 v_texCoord;
out vec4 outColor;

void main() {
    // Y座標を反転
    vec2 flippedTexCoord = vec2(v_texCoord.x, 1.0 - v_texCoord.y);
    
    outColor = texture(u_image2, flippedTexCoord);
}`,K=`#version 300 es
in vec2 a_position;
out vec2 v_texCoord;

void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texCoord = (a_position + 1.0) * 0.5;
}`;const G=23283064365386963e-26,Y=12,N=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),C=0,k=1,T=2,D=5;class Q{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,i,r=this.length){for(;this.pos<r;){const n=this.readVarint(),s=n>>3,o=this.pos;this.type=n&7,t(s,i,this),this.pos===o&&this.skip(n)}return i}readMessage(t,i){return this.readFields(t,i,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const i=this.buf;let r,n;return n=i[this.pos++],r=n&127,n<128||(n=i[this.pos++],r|=(n&127)<<7,n<128)||(n=i[this.pos++],r|=(n&127)<<14,n<128)||(n=i[this.pos++],r|=(n&127)<<21,n<128)?r:(n=i[this.pos],r|=(n&15)<<28,q(r,t,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2===1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,i=this.pos;return this.pos=t,t-i>=Y&&N?N.decode(this.buf.subarray(i,t)):ft(this.buf,i,t)}readBytes(){const t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i}readPackedVarint(t=[],i){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readVarint(i));return t}readPackedSVarint(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===T?this.readVarint()+this.pos:this.pos+1}skip(t){const i=t&7;if(i===C)for(;this.buf[this.pos++]>127;);else if(i===T)this.pos=this.readVarint()+this.pos;else if(i===D)this.pos+=4;else if(i===k)this.pos+=8;else throw new Error(`Unimplemented type: ${i}`)}writeTag(t,i){this.writeVarint(t<<3|i)}realloc(t){let i=this.length||16;for(;i<this.pos+t;)i*=2;if(i!==this.length){const r=new Uint8Array(i);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*G),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*G),!0),this.pos+=8}writeVarint(t){if(t=+t||0,t>268435455||t<0){tt(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))}writeSVarint(t){this.writeVarint(t<0?-t*2-1:t*2)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(t.length*4),this.pos++;const i=this.pos;this.pos=ct(this.buf,t,this.pos);const r=this.pos-i;r>=128&&H(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const i=t.length;this.writeVarint(i),this.realloc(i);for(let r=0;r<i;r++)this.buf[this.pos++]=t[r]}writeRawMessage(t,i){this.pos++;const r=this.pos;t(i,this);const n=this.pos-r;n>=128&&H(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n}writeMessage(t,i,r){this.writeTag(t,T),this.writeRawMessage(i,r)}writePackedVarint(t,i){i.length&&this.writeMessage(t,nt,i)}writePackedSVarint(t,i){i.length&&this.writeMessage(t,rt,i)}writePackedBoolean(t,i){i.length&&this.writeMessage(t,ht,i)}writePackedFloat(t,i){i.length&&this.writeMessage(t,st,i)}writePackedDouble(t,i){i.length&&this.writeMessage(t,ot,i)}writePackedFixed32(t,i){i.length&&this.writeMessage(t,at,i)}writePackedSFixed32(t,i){i.length&&this.writeMessage(t,lt,i)}writePackedFixed64(t,i){i.length&&this.writeMessage(t,ut,i)}writePackedSFixed64(t,i){i.length&&this.writeMessage(t,xt,i)}writeBytesField(t,i){this.writeTag(t,T),this.writeBytes(i)}writeFixed32Field(t,i){this.writeTag(t,D),this.writeFixed32(i)}writeSFixed32Field(t,i){this.writeTag(t,D),this.writeSFixed32(i)}writeFixed64Field(t,i){this.writeTag(t,k),this.writeFixed64(i)}writeSFixed64Field(t,i){this.writeTag(t,k),this.writeSFixed64(i)}writeVarintField(t,i){this.writeTag(t,C),this.writeVarint(i)}writeSVarintField(t,i){this.writeTag(t,C),this.writeSVarint(i)}writeStringField(t,i){this.writeTag(t,T),this.writeString(i)}writeFloatField(t,i){this.writeTag(t,D),this.writeFloat(i)}writeDoubleField(t,i){this.writeTag(t,k),this.writeDouble(i)}writeBooleanField(t,i){this.writeVarintField(t,+i)}}function q(e,t,i){const r=i.buf;let n,s;if(s=r[i.pos++],n=(s&112)>>4,s<128||(s=r[i.pos++],n|=(s&127)<<3,s<128)||(s=r[i.pos++],n|=(s&127)<<10,s<128)||(s=r[i.pos++],n|=(s&127)<<17,s<128)||(s=r[i.pos++],n|=(s&127)<<24,s<128)||(s=r[i.pos++],n|=(s&1)<<31,s<128))return P(e,n,t);throw new Error("Expected varint not more than 10 bytes")}function P(e,t,i){return i?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function tt(e,t){let i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(i=~(-e%4294967296),r=~(-e/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),et(i,r,t),it(r,t)}function et(e,t,i){i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos]=e&127}function it(e,t){const i=(e&7)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function H(e,t,i){const r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));i.realloc(r);for(let n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function nt(e,t){for(let i=0;i<e.length;i++)t.writeVarint(e[i])}function rt(e,t){for(let i=0;i<e.length;i++)t.writeSVarint(e[i])}function st(e,t){for(let i=0;i<e.length;i++)t.writeFloat(e[i])}function ot(e,t){for(let i=0;i<e.length;i++)t.writeDouble(e[i])}function ht(e,t){for(let i=0;i<e.length;i++)t.writeBoolean(e[i])}function at(e,t){for(let i=0;i<e.length;i++)t.writeFixed32(e[i])}function lt(e,t){for(let i=0;i<e.length;i++)t.writeSFixed32(e[i])}function ut(e,t){for(let i=0;i<e.length;i++)t.writeFixed64(e[i])}function xt(e,t){for(let i=0;i<e.length;i++)t.writeSFixed64(e[i])}function ft(e,t,i){let r="",n=t;for(;n<i;){const s=e[n];let o=null,h=s>239?4:s>223?3:s>191?2:1;if(n+h>i)break;let l,a,f;h===1?s<128&&(o=s):h===2?(l=e[n+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):h===3?(l=e[n+1],a=e[n+2],(l&192)===128&&(a&192)===128&&(o=(s&15)<<12|(l&63)<<6|a&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):h===4&&(l=e[n+1],a=e[n+2],f=e[n+3],(l&192)===128&&(a&192)===128&&(f&192)===128&&(o=(s&15)<<18|(l&63)<<12|(a&63)<<6|f&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,h=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),n+=h}return r}function ct(e,t,i){for(let r=0,n,s;r<t.length;r++){if(n=t.charCodeAt(r),n>55295&&n<57344)if(s)if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||r+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):s=n;continue}else s&&(e[i++]=239,e[i++]=191,e[i++]=189,s=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=n&63|128)}return i}function E(e,t){this.x=e,this.y=t}E.prototype={clone(){return new E(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,i=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=i,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),i=Math.sin(e),r=t*this.x-i*this.y,n=i*this.x+t*this.y;return this.x=r,this.y=n,this},_rotateAround(e,t){const i=Math.cos(e),r=Math.sin(e),n=t.x+i*(this.x-t.x)-r*(this.y-t.y),s=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=n,this.y=s,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:E},E.convert=function(e){if(e instanceof E)return e;if(Array.isArray(e))return new E(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new E(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};class O{constructor(t,i,r,n,s){this.properties={},this.extent=r,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=s,t.readFields(dt,this,i)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos,r=[];let n,s=1,o=0,h=0,l=0;for(;t.pos<i;){if(o<=0){const a=t.readVarint();s=a&7,o=a>>3}if(o--,s===1||s===2)h+=t.readSVarint(),l+=t.readSVarint(),s===1&&(n&&r.push(n),n=[]),n&&n.push(new E(h,l));else if(s===7)n&&n.push(n[0].clone());else throw new Error(`unknown command ${s}`)}return n&&r.push(n),r}bbox(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos;let r=1,n=0,s=0,o=0,h=1/0,l=-1/0,a=1/0,f=-1/0;for(;t.pos<i;){if(n<=0){const w=t.readVarint();r=w&7,n=w>>3}if(n--,r===1||r===2)s+=t.readSVarint(),o+=t.readSVarint(),s<h&&(h=s),s>l&&(l=s),o<a&&(a=o),o>f&&(f=o);else if(r!==7)throw new Error(`unknown command ${r}`)}return[h,a,l,f]}toGeoJSON(t,i,r){const n=this.extent*Math.pow(2,r),s=this.extent*t,o=this.extent*i,h=this.loadGeometry();function l(x){return[(x.x+s)*360/n-180,360/Math.PI*Math.atan(Math.exp((1-(x.y+o)*2/n)*Math.PI))-90]}function a(x){return x.map(l)}let f;if(this.type===1){const x=[];for(const y of h)x.push(y[0]);const F=a(x);f=x.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const x=h.map(a);f=x.length===1?{type:"LineString",coordinates:x[0]}:{type:"MultiLineString",coordinates:x}}else if(this.type===3){const x=yt(h),F=[];for(const y of x)F.push(y.map(a));f=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}else throw new Error("unknown feature type");const w={type:"Feature",geometry:f,properties:this.properties};return this.id!=null&&(w.id=this.id),w}}O.types=["Unknown","Point","LineString","Polygon"];function dt(e,t,i){e===1?t.id=i.readVarint():e===2?wt(i,t):e===3?t.type=i.readVarint():e===4&&(t._geometry=i.pos)}function wt(e,t){const i=e.readVarint()+e.pos;for(;e.pos<i;){const r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}function yt(e){const t=e.length;if(t<=1)return[e];const i=[];let r,n;for(let s=0;s<t;s++){const o=pt(e[s]);o!==0&&(n===void 0&&(n=o<0),n===o<0?(r&&i.push(r),r=[e[s]]):r&&r.push(e[s]))}return r&&i.push(r),i}function pt(e){let t=0;for(let i=0,r=e.length,n=r-1,s,o;i<r;n=i++)s=e[i],o=e[n],t+=(o.x-s.x)*(s.y+o.y);return t}class Ft{constructor(t,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(gt,this,i),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const i=this._pbf.readVarint()+this._pbf.pos;return new O(this._pbf,i,this.extent,this._keys,this._values)}}function gt(e,t,i){e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(_t(i))}function _t(e){let t=null;const i=e.readVarint()+e.pos;for(;e.pos<i;){const r=e.readVarint()>>3;t=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null}return t}class Et{constructor(t,i){this.layers=t.readFields(Vt,{},i)}}function Vt(e,t,i){if(e===3){const r=new Ft(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}function Pt(e,t,i=2){const r=e.length;let n=Tt(e,0,r,i,!0);const s=[];if(!n||n.next===n.prev)return s;let o,h,l;if(e.length>80*i){o=1/0,h=1/0;let a=-1/0,f=-1/0;for(let w=i;w<r;w+=i){const x=e[w],F=e[w+1];x<o&&(o=x),F<h&&(h=F),x>a&&(a=x),F>f&&(f=F)}l=Math.max(a-o,f-h),l=l!==0?32767/l:0}return S(n,s,i,o,h,l,0),s}function Tt(e,t,i,r,n){let s;if(n===Ct(e,t,i,r)>0)for(let o=t;o<i;o+=r)s=b(o/r|0,e[o],e[o+1],s);else for(let o=i-r;o>=t;o-=r)s=b(o/r|0,e[o],e[o+1],s);return s&&B(s,s.next)&&(M(s),s=s.next),s}function v(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(B(i,i.next)||p(i.prev,i,i.next)===0)){if(M(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function S(e,t,i,r,n,s,o){if(!e)return;!o&&s&&kt(e,r,n,s);let h=e;for(;e.prev!==e.next;){const l=e.prev,a=e.next;if(s?St(e,r,n,s):vt(e)){t.push(l.i,e.i,a.i),M(e),e=a.next,h=a.next;continue}if(e=a,e===h){o?o===1?(e=mt(v(e),t),S(e,t,i,r,n,s,2)):o===2&&Mt(e,t,i,r,n,s):S(v(e),t,i,r,n,s,1);break}}}function vt(e){const t=e.prev,i=e,r=e.next;if(p(t,i,r)>=0)return!1;const n=t.x,s=i.x,o=r.x,h=t.y,l=i.y,a=r.y,f=n<s?n<o?n:o:s<o?s:o,w=h<l?h<a?h:a:l<a?l:a,x=n>s?n>o?n:o:s>o?s:o,F=h>l?h>a?h:a:l>a?l:a;let y=r.next;for(;y!==t;){if(y.x>=f&&y.x<=x&&y.y>=w&&y.y<=F&&m(n,h,s,l,o,a,y.x,y.y)&&p(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function St(e,t,i,r){const n=e.prev,s=e,o=e.next;if(p(n,s,o)>=0)return!1;const h=n.x,l=s.x,a=o.x,f=n.y,w=s.y,x=o.y,F=h<l?h<a?h:a:l<a?l:a,y=f<w?f<x?f:x:w<x?w:x,_=h>l?h>a?h:a:l>a?l:a,V=f>w?f>x?f:x:w>x?w:x,j=L(F,y,t,i,r),$=L(_,V,t,i,r);let c=e.prevZ,d=e.nextZ;for(;c&&c.z>=j&&d&&d.z<=$;){if(c.x>=F&&c.x<=_&&c.y>=y&&c.y<=V&&c!==n&&c!==o&&m(h,f,l,w,a,x,c.x,c.y)&&p(c.prev,c,c.next)>=0||(c=c.prevZ,d.x>=F&&d.x<=_&&d.y>=y&&d.y<=V&&d!==n&&d!==o&&m(h,f,l,w,a,x,d.x,d.y)&&p(d.prev,d,d.next)>=0))return!1;d=d.nextZ}for(;c&&c.z>=j;){if(c.x>=F&&c.x<=_&&c.y>=y&&c.y<=V&&c!==n&&c!==o&&m(h,f,l,w,a,x,c.x,c.y)&&p(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;d&&d.z<=$;){if(d.x>=F&&d.x<=_&&d.y>=y&&d.y<=V&&d!==n&&d!==o&&m(h,f,l,w,a,x,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function mt(e,t){let i=e;do{const r=i.prev,n=i.next.next;!B(r,n)&&X(r,i,i.next,n)&&R(r,n)&&R(n,r)&&(t.push(r.i,i.i,n.i),M(i),M(i.next),i=e=n),i=i.next}while(i!==e);return v(i)}function Mt(e,t,i,r,n,s){let o=e;do{let h=o.next.next;for(;h!==o.prev;){if(o.i!==h.i&&Bt(o,h)){let l=Rt(o,h);o=v(o,o.next),l=v(l,l.next),S(o,t,i,r,n,s,0),S(l,t,i,r,n,s,0);return}h=h.next}o=o.next}while(o!==e)}function kt(e,t,i,r){let n=e;do n.z===0&&(n.z=L(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,Dt(n)}function Dt(e){let t,i=1;do{let r=e,n;e=null;let s=null;for(t=0;r;){t++;let o=r,h=0;for(let a=0;a<i&&(h++,o=o.nextZ,!!o);a++);let l=i;for(;h>0||l>0&&o;)h!==0&&(l===0||!o||r.z<=o.z)?(n=r,r=r.nextZ,h--):(n=o,o=o.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=o}s.nextZ=null,i*=2}while(t>1);return e}function L(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function m(e,t,i,r,n,s,o,h){return(n-o)*(t-h)>=(e-o)*(s-h)&&(e-o)*(r-h)>=(i-o)*(t-h)&&(i-o)*(s-h)>=(n-o)*(r-h)}function Bt(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!It(e,t)&&(R(e,t)&&R(t,e)&&At(e,t)&&(p(e.prev,e,t.prev)||p(e,t.prev,t))||B(e,t)&&p(e.prev,e,e.next)>0&&p(t.prev,t,t.next)>0)}function p(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function B(e,t){return e.x===t.x&&e.y===t.y}function X(e,t,i,r){const n=A(p(e,t,i)),s=A(p(e,t,r)),o=A(p(i,r,e)),h=A(p(i,r,t));return!!(n!==s&&o!==h||n===0&&I(e,i,t)||s===0&&I(e,r,t)||o===0&&I(i,e,r)||h===0&&I(i,t,r))}function I(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function A(e){return e>0?1:e<0?-1:0}function It(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&X(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function R(e,t){return p(e.prev,e,e.next)<0?p(e,t,e.next)>=0&&p(e,e.prev,t)>=0:p(e,t,e.prev)<0||p(e,e.next,t)<0}function At(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function Rt(e,t){const i=U(e.i,e.x,e.y),r=U(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function b(e,t,i,r){const n=U(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function U(e,t,i){return{i:e,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ct(e,t,i,r){let n=0;for(let s=t,o=i-r;s<i;s+=r)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}const Lt=e=>{const t=new Q(e);return new Et(t)};let u=null,g=null,Z=null,W=null;const Ut=e=>{if(u=e.getContext("webgl2"),!u)throw new Error("WebGL not supported");const t=(o,h,l)=>{const a=o.createShader(h);return a?(o.shaderSource(a,l),o.compileShader(a),o.getShaderParameter(a,o.COMPILE_STATUS)?a:(console.error("An error occurred compiling the shaders: "+o.getShaderInfoLog(a)),o.deleteShader(a),null)):(console.error("Unable to create shader"),null)},i=t(u,u.VERTEX_SHADER,K),r=t(u,u.FRAGMENT_SHADER,J);if(!i||!r)throw new Error("Failed to load shaders");if(g=u.createProgram(),!g)throw new Error("Failed to create program");if(u.attachShader(g,i),u.attachShader(g,r),u.linkProgram(g),!u.getProgramParameter(g,u.LINK_STATUS))throw console.error("Unable to initialize the shader program: "+u.getProgramInfoLog(g)),new Error("Failed to link program");u.useProgram(g),Z=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,Z);const n=u.getAttribLocation(g,"a_position");u.enableVertexAttribArray(n),u.vertexAttribPointer(n,2,u.FLOAT,!1,0,0);const s=u.createTexture();return u.bindTexture(u.TEXTURE_2D,s),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),s},z=new OffscreenCanvas(256,256);self.onmessage=async e=>{const{url:t,tile:i,image:r}=e.data,s=Lt(i).layers.waterarea;try{if(u||(W=Ut(z)),!u||!g||!Z)throw new Error("WebGL initialization failed");if(u.bindTexture(u.TEXTURE_2D,W),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,r),u.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT),s)for(let l=0;l<s.length;l++){const a=s.feature(l),f=a.loadGeometry();for(const w of f)if(a.type===3){const x=w.flatMap(({x:_,y:V})=>[_,V]),y=Pt(x).flatMap(_=>[x[_*2]/s.extent*2-1,1-x[_*2+1]/s.extent*2]);u.bufferData(u.ARRAY_BUFFER,new Float32Array(y),u.STATIC_DRAW),u.drawArrays(u.TRIANGLES,0,y.length/2)}}const o=await z.convertToBlob();if(!o)throw new Error("Failed to convert canvas to blob");const h=await o.arrayBuffer();self.postMessage({id:t,buffer:h})}catch(o){o instanceof Error&&self.postMessage({id:t,error:o.message})}}})();
